# LLM 프롬프트 및 매핑 로직 개선 요약

## 문제점

1. **LLM이 가짜 노래 이름 생성** - DB에 없는 노래만 나옴
2. **매핑 실패** - musicSelection이 DB에 없어서 매핑 안됨
3. **아이콘 다양성 부족** - 비슷한 아이콘만 사용
4. **캐롤 미적용** - 초기 세그먼트에 캐롤 음악 없음
5. **오디오 에러** - 파일 경로 문제

## 수정 사항

### 1. 프롬프트 강화
- 실제 DB 노래 목록을 프롬프트 **맨 앞**에 배치
- 매우 강력한 경고 메시지 추가
- 금지된 예시 명시 (Cozy Comfort 등)
- Temperature를 0.9 → 0.3으로 낮춤

### 2. 매핑 로직 개선
- 각 세그먼트마다 1개 노래만 사용 (10세그먼트 = 10개 노래)
- 전체 DB에서 검색 (장르 필터 제거)
- 부분 일치 매칭 추가
- 실제 MP3 길이 사용

### 3. 로깅 강화
- 매핑 실패 시 자세한 로그 출력
- LLM이 제공한 musicSelection과 매핑 결과 로깅

### 4. 초기 캐롤 세그먼트
- 각 세그먼트마다 1개 캐롤 노래
- 실제 MP3 길이 사용

## 다음 단계

1. 로그 확인하여 LLM이 어떤 musicSelection을 제공하는지 확인
2. 매핑 실패 원인 분석
3. 필요 시 프롬프트 추가 강화

