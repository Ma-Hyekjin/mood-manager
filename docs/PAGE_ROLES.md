# 페이지별 역할 정리

## 1. 로그인 페이지 (`/login`)

### 역할
- **사용자 인증**: 이메일/비밀번호 또는 소셜 로그인으로 인증
- **세션 관리**: NextAuth를 통한 세션 생성
- **리다이렉트**: 
  - 로그인 성공 시 → 설문 조사 완료 여부 확인 → `/survey` 또는 `/home`으로 이동
  - 이미 로그인된 상태면 → `/home`으로 자동 이동

### 현재 구현 상태
- ✅ 목업 모드: `test@example.com` / `1234`로 로그인 가능
- ✅ 소셜 로그인: Google, Kakao, Naver 지원
- ✅ Rate Limiting: 5회 실패 시 15분 잠금
- ⚠️ 설문 조사 확인: 목업으로 항상 `/home`으로 이동 (실제로는 `/api/auth/survey-status` 호출 필요)

---

## 2. 회원가입 페이지 (`/register`)

### 역할
- **사용자 등록**: 새 계정 생성
- **데이터 전달**: name, email, password를 백엔드로 전달
- **리다이렉트**: 회원가입 성공 시 → `/survey`로 이동

### 현재 구현 상태
- ✅ 클라이언트 사이드 검증: 이메일 형식, 비밀번호 강도, 정책 안내
- ✅ 목업 모드: `/api/auth/register` 호출 → 목업 응답 → 세션 생성 → `/survey` 이동
- ✅ 백엔드 연동 준비: 주석 처리된 API 호출 코드 포함

### 데이터 흐름
```
[프론트엔드]
사용자 입력 (name, email, password)
  ↓
클라이언트 사이드 검증
  ↓
POST /api/auth/register
  ↓
[백엔드]
서버 사이드 검증 (이메일 중복 체크 등)
  ↓
비밀번호 해싱
  ↓
DB 저장 (MySQL)
  ↓
응답 반환
  ↓
[프론트엔드]
NextAuth 세션 생성
  ↓
/survey로 이동
```

---

## 3. 홈 페이지 (`/home`)

### 역할
- **무드 대시보드**: 현재 무드 표시 및 제어
- **디바이스 관리**: 디바이스 목록 조회, 추가, 삭제, 제어
- **무드 변경**: 색상, 음악, 향 변경

### 현재 구현 상태
- ✅ 무드 대시보드: 목업 무드 데이터로 표시
- ✅ 디바이스 그리드: 목업 디바이스 데이터로 표시
- ⚠️ 무드 생성 로직: **아직 구현되지 않음** (현재는 MOODS 배열에서 수동 선택)

### 무드 생성 로직 (README 기준)

**목표 파이프라인:**
```
WearOS → Firebase → ML 서버 → Next.js → OpenAI → 무드 추론
```

**상세 흐름:**
1. **WearOS**: 생체 데이터(HRV, 스트레스) + 오디오 이벤트 수집
2. **Firebase**: `users/{userId}/raw_periodic` (생체), `users/{userId}/raw_events` (오디오) 저장
3. **ML 서버**: 오디오를 웃음/한숨으로 분류
4. **Next.js**: 
   - Firestore에서 생체 데이터 + ML 결과 수집
   - 사용자 선호도 + 날씨 정보 결합
   - OpenAI Few-shot + RAG로 무드 추론
5. **무드 결과**: 색상, 음악, 향이 포함된 무드 객체 반환

**현재 상태:**
- ❌ Firebase 연동: 파일은 있지만 구현 안 됨 (`src/lib/firebase.ts`)
- ❌ OpenAI 연동: 파일은 있지만 구현 안 됨 (`src/lib/openai.ts`)
- ❌ 무드 추론 로직: 구현 안 됨
- ✅ 무드 표시: MOODS 배열에서 선택하여 표시

---

## 무드 생성 로직 구현 필요 사항

### 1. Firebase 연동 (`src/lib/firebase.ts`)
```typescript
// TODO: 구현 필요
// - Firestore에서 생체 데이터 조회
// - ML 분류 결과 수신
// - 실시간 데이터 리스너 설정
```

### 2. OpenAI 연동 (`src/lib/openai.ts`)
```typescript
// TODO: 구현 필요
// - Few-shot 프롬프트 생성
// - LangChain RAG 설정
// - 무드 추론 API 호출
```

### 3. 무드 추론 API (`/api/ai/chat/route.ts` 또는 새 엔드포인트)
```typescript
// TODO: 구현 필요
// - 생체 데이터 + 오디오 이벤트 + 선호도 + 날씨 수집
// - OpenAI로 무드 추론 요청
// - 무드 결과 반환
```

### 4. 홈 페이지 무드 로드
```typescript
// 현재: MOODS[0] 고정
// 목표: API에서 추론된 무드 받아서 표시
```

---

## 현재 vs 목표

### 현재 상태
- 무드는 **사용자가 수동으로 선택** (앨범 클릭, 센트 클릭, 새로고침 버튼)
- MOODS 배열에서 랜덤 선택
- Firebase/OpenAI 연동 없음

### 목표 상태 (README 기준)
- 무드는 **AI가 자동으로 추론**
- WearOS 데이터 → Firebase → ML → OpenAI → 무드
- 실시간으로 사용자 상태에 맞는 무드 추천

---

## 결론

### 각 페이지 역할
1. **로그인 페이지**: ✅ 역할 수행 중 (인증 처리)
2. **회원가입 페이지**: ✅ 역할 수행 중 (데이터 전달)
3. **홈 페이지**: ⚠️ 부분적 역할 수행
   - 디바이스 관리: ✅ 완료
   - 무드 표시: ✅ 완료
   - **무드 자동 생성: ❌ 미구현** (README에 설명은 있음)

### 무드 생성 로직
- **README에 설명 있음**: WearOS → Firebase → ML → OpenAI 파이프라인
- **현재 코드에는 미구현**: 수동 선택 방식만 존재
- **구현 필요**: Firebase, OpenAI 연동 및 무드 추론 로직

